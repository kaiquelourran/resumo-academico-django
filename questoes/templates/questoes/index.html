{% extends 'questoes/base.html' %}
{% load static %}
{% load questao_filters %}

{% block title %}In√≠cio - Resumo Acad√™mico{% endblock %}

{% block page_header %}
<!-- Page Title Section -->
<div class="page-header">
    <div class="header-container">
        <h1 class="page-title">In√≠cio</h1>
        <p class="page-subtitle">Bem-vindo ao Sistema de Quest√µes - Resumo Acad√™mico</p>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    body {
        background-image: linear-gradient(to top, #00C6FF, #0072FF);
        min-height: 100vh;
        margin: 0;
    }
    
    .main-container {
        max-width: 1100px;
        margin: 0 auto;
        background: #FFFFFF;
        border-radius: 16px;
        border: 1px solid transparent;
        background-image: linear-gradient(#FFFFFF, #FFFFFF), linear-gradient(to top, #00C6FF, #0072FF);
        background-origin: border-box;
        background-clip: padding-box, border-box;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        padding: 0 30px 30px 30px;
    }
    
    /* Estat√≠sticas */
    .stats-container {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 40px;
    }
    
    .stat-card {
        background: #FFFFFF;
        border: 1px solid #e1e5e9;
        border-radius: 12px;
        padding: 20px;
        min-width: 200px;
        text-align: center;
        box-shadow: 0 10px 20px rgba(0,0,0,0.06);
    }
    
    .stat-number {
        color: #0072FF;
        font-weight: 700;
        font-size: 2rem;
    }
    
    .stat-label {
        color: #333;
    }
    
    /* Cards */
    .cards-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 40px;
    }
    
    .card {
        border-radius: 12px;
        padding: 24px;
        width: 300px;
        text-align: center;
        box-shadow: 0 10px 20px rgba(0,0,0,0.06);
        transition: transform .2s ease, box-shadow .2s ease;
    }
    
    .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 14px 30px rgba(0,114,255,0.18);
    }
    
    .card-icon {
        font-size: 3em;
        margin-bottom: 15px;
        display: block;
    }
    
    .card-title {
        font-size: 1.3em;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .card-description {
        margin-bottom: 20px;
        line-height: 1.6;
    }
    
    .btn {
        display: inline-block;
        padding: 12px 18px;
        border-radius: 8px;
        color: #fff;
        border: 2px solid white;
        background: rgba(255,255,255,0.2);
        font-weight: 600;
        text-decoration: none;
        transition: transform .2s ease, box-shadow .2s ease;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,114,255,0.3);
        background: rgba(255,255,255,0.3);
    }
    
    .admin-area {
        margin-top: 50px;
    }
    
    .admin-area h2 {
        text-align: center;
        margin-bottom: 30px;
        color: #333;
        font-size: 2em;
    }
    
    .restricted-area {
        text-align: center;
        margin-top: 50px;
        padding: 40px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 16px;
    }
    
    .restricted-area h2 {
        color: #00C6FF;
        margin-bottom: 15px;
    }
    
    .restricted-area p {
        color: #666;
        font-size: 1.1em;
    }
    
    .restricted-area p:last-child {
        color: #888;
    }
    
    @media (max-width: 768px) {
        html, body { overflow-x: hidden; }
        .main-container {
            margin: 16px auto;
            padding: 18px;
            max-width: calc(100% - 32px);
        }
        .stats-container { flex-direction: column; gap: 12px; }
        .stat-card { width: 100%; }
        .cards-container { flex-direction: column; gap: 16px; }
        .card { width: 100%; padding: 20px; }
        .card-icon { display: block; font-size: 1.5rem; margin-bottom: 8px; }
        .card-title { margin-bottom: 6px; }
        .card-description { font-size: .95rem; }
        .btn { width: 100%; }
    }
    
    @media (max-width: 480px) {
        .stat-number { font-size: 1.6rem; }
        .main-container {
            margin: 10px auto;
            padding: 15px;
            max-width: calc(100% - 20px);
        }
    }
    
    /* Ranking Semanal - Estilo da Imagem */
    .ranking-card {
        max-width: 1050px;
        margin: 40px auto;
        border-radius: 12px;
        overflow: hidden;
        background: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
    }
    
    .ranking-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px 24px;
        color: #fff;
        background: linear-gradient(90deg, #0072FF 0%, #00C6FF 100%);
        border-radius: 12px 12px 0 0;
    }
    
    .ranking-header .logo {
        font-size: 28px;
    }
    
    .ranking-header .title {
        flex: 1;
        font-size: 22px;
        font-weight: 700;
        color: #fff;
        margin: 0;
    }
    
    .ranking-header .subtitle {
        font-size: 13px;
        color: #fff;
        margin: 4px 0 0 0;
        font-weight: 400;
    }
    
    .ranking-list {
        list-style: none;
        margin: 0;
        padding: 0;
    }
    
    .ranking-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        padding: 16px 24px;
        background: #fff;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .ranking-item:last-child {
        border-bottom: none;
    }
    
    .ranking-left {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
        min-width: 0;
    }
    
    .rank-medal {
        font-size: 20px;
        width: 28px;
        text-align: center;
        flex-shrink: 0;
    }
    
    .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #E8E9EB;
        color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
    }
    
    .name {
        color: #333;
        font-weight: 400;
        font-size: 15px;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .name strong {
        font-weight: 600;
        margin-right: 4px;
    }
    
    .you-badge {
        padding: 2px 8px;
        border-radius: 12px;
        background: #C8D5E0;
        color: #4A5568;
        font-weight: 500;
        font-size: 11px;
        white-space: nowrap;
    }
    
    .ranking-right {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-shrink: 0;
    }
    
    .bar {
        position: relative;
        height: 4px;
        border-radius: 2px;
        background: #E8E9EB;
        overflow: hidden;
        width: 120px;
        flex-shrink: 0;
    }
    
    .bar span {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: linear-gradient(90deg, #0072FF 0%, #00C6FF 100%);
        transition: width 0.6s ease;
        border-radius: 2px;
    }
    
    .count-badge {
        padding: 0;
        border-radius: 0;
        font-weight: 400;
        font-size: 13px;
        white-space: nowrap;
        background: transparent;
        border: none;
        box-shadow: none;
    }
    
    .badge-total {
        color: #0072FF;
    }
    
    .badge-acertos {
        color: #4CAF50;
    }
    
    .badge-taxa {
        color: #4CAF50;
    }
    
    .your-rank-card {
        margin: 0;
        padding: 16px 24px;
        background: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        border-top: 1px solid #f0f0f0;
    }
    
    .your-rank-left {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
        min-width: 0;
    }
    
    .your-rank-left .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #E8E9EB;
        color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
    }
    
    .your-rank-left .title {
        font-weight: 400;
        color: #333;
        margin: 0;
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .your-rank-left .details {
        color: #666;
        font-size: 13px;
        margin: 4px 0 0 0;
        font-weight: 400;
    }
    
    .ranking-empty {
        padding: 40px 20px;
        color: #666;
        text-align: center;
        font-size: 15px;
        font-weight: 400;
        background: #fff;
    }
    
    .fade-in {
        animation: fadeInUp 0.4s ease-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @media (max-width: 768px) {
        .ranking-card {
            margin: 20px 10px;
            border-radius: 8px;
        }
        
        .ranking-header {
            padding: 16px 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .ranking-header .title {
            font-size: 20px;
        }
        
        .ranking-header .subtitle {
            font-size: 12px;
        }
        
        .ranking-item {
            padding: 14px 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .ranking-left {
            min-width: 0;
            flex: 1 1 100%;
        }
        
        .ranking-right {
            flex-wrap: wrap;
            gap: 8px;
            width: 100%;
        }
        
        .bar {
            width: 100%;
            max-width: 100%;
        }
        
        .count-badge {
            font-size: 12px;
        }
        
        .your-rank-card {
            padding: 14px 20px;
            flex-wrap: wrap;
        }
        
        .your-rank-left {
            flex: 1 1 100%;
            margin-bottom: 8px;
        }
        
        .your-rank-left .title {
            flex-wrap: wrap;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- Estat√≠sticas -->
<div class="stats-container">
    <div class="stat-card">
        <div class="stat-number">{{ total_assuntos }}</div>
        <div class="stat-label">Conte√∫dos</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_questoes }}</div>
        <div class="stat-label">Quest√µes</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_alternativas }}</div>
        <div class="stat-label">Alternativas</div>
    </div>
</div>

<!-- Ranking Semanal -->
<div class="ranking-card fade-in">
    <div class="ranking-header">
        <span class="logo">üèÜ</span>
        <div>
            <h2 class="title">Ranking semanal</h2>
            <p class="subtitle">Top 5 que mais responderam quest√µes na semana (segunda a domingo)</p>
        </div>
    </div>
    
    {% if ranking_semanal %}
    <ul class="ranking-list">
        {% for item in ranking_semanal %}
        <li class="ranking-item {% if user.is_authenticated and item.id_usuario == user.id %}is-current-user{% endif %}">
            <div class="ranking-left">
                <span class="rank-medal">
                    {% if forloop.counter == 1 %}ü•á
                    {% elif forloop.counter == 2 %}ü•à
                    {% elif forloop.counter == 3 %}ü•â
                    {% else %}üèÖ{% endif %}
                </span>
                <div class="avatar">
                    {% if item.nome %}
                        {{ item.nome|iniciais }}
                    {% else %}
                        {{ item.username|first|upper }}{{ item.username|first|upper }}
                    {% endif %}
                </div>
                <span class="name">
                    <strong>{% if item.nome %}{{ item.nome|iniciais }}{% else %}{{ item.username|first|upper }}{{ item.username|first|upper }}{% endif %}</strong>
                    {{ item.nome|default:item.username|lower }}
                    {% if user.is_authenticated and item.id_usuario == user.id %}
                    <span class="you-badge">Voc√™</span>
                    {% endif %}
                </span>
            </div>
            <div class="ranking-right">
                <div class="bar">
                    <span style="width: {% if max_total > 0 %}{% widthratio item.total max_total 100 %}{% else %}100{% endif %}%; min-width: 6%; max-width: 100%;"></span>
                </div>
                <span class="count-badge badge-total">{{ item.total }} respostas</span>
                <span class="count-badge badge-acertos">{{ item.acertos }} acertos</span>
                <span class="count-badge badge-taxa">{{ item.taxa_acerto }}%</span>
            </div>
        </li>
        {% endfor %}
    </ul>
    
    <!-- Card "Sua Posi√ß√£o" (se usu√°rio n√£o estiver no Top 5 ou n√£o houver Top 5) -->
    {% if dados_usuario %}
    <div class="your-rank-card">
        <div class="your-rank-left">
            <div class="avatar">
                {% if dados_usuario.nome %}
                    {{ dados_usuario.nome|iniciais }}
                {% else %}
                    {{ dados_usuario.username|first|upper }}{{ dados_usuario.username|first|upper }}
                {% endif %}
            </div>
            <div>
                <p class="title">
                    <strong>{% if dados_usuario.nome %}{{ dados_usuario.nome|iniciais }}{% else %}{{ dados_usuario.username|first|upper }}{{ dados_usuario.username|first|upper }}{% endif %}</strong>
                    {{ dados_usuario.nome|default:dados_usuario.username|lower }}
                    <span class="you-badge">Voc√™</span>
                </p>
                <p class="details"></p>
            </div>
        </div>
        <div class="ranking-right">
            <div class="bar" style="max-width: 300px;">
                <span style="width: {% if max_total > 0 %}{% widthratio dados_usuario.total max_total 100 %}{% else %}100{% endif %}%; min-width: 6%; max-width: 100%;"></span>
            </div>
            <span class="count-badge badge-total">{{ dados_usuario.total }} respostas</span>
            <span class="count-badge badge-acertos">{{ dados_usuario.acertos }} acertos</span>
            <span class="count-badge badge-taxa">{{ dados_usuario.taxa_acerto }}%</span>
        </div>
    </div>
    {% endif %}
    
    {% else %}
        <!-- Sem Top 5, mas pode ter dados do usu√°rio -->
        {% if dados_usuario %}
            <!-- Exibir card do usu√°rio mesmo sem Top 5 -->
        {% else %}
            <div class="ranking-empty">
                Nenhuma atividade nesta semana para exibir o ranking.
            </div>
        {% endif %}
    {% endif %}
    
    <!-- Card "Sua Posi√ß√£o" quando n√£o h√° Top 5 mas h√° dados do usu√°rio -->
    {% if not ranking_semanal and dados_usuario %}
    <div class="your-rank-card">
        <div class="your-rank-left">
            <div class="avatar">
                {% if dados_usuario.nome %}
                    {{ dados_usuario.nome|iniciais }}
                {% else %}
                    {{ dados_usuario.username|first|upper }}{{ dados_usuario.username|first|upper }}
                {% endif %}
            </div>
            <div>
                <p class="title">
                    <strong>{% if dados_usuario.nome %}{{ dados_usuario.nome|iniciais }}{% else %}{{ dados_usuario.username|first|upper }}{{ dados_usuario.username|first|upper }}{% endif %}</strong>
                    {{ dados_usuario.nome|default:dados_usuario.username|lower }}
                    <span class="you-badge">Voc√™</span>
                </p>
                <p class="details"></p>
            </div>
        </div>
        <div class="ranking-right">
            <div class="bar" style="max-width: 300px;">
                <span style="width: {% if max_total > 0 %}{% widthratio dados_usuario.total max_total 100 %}{% else %}100{% endif %}%; min-width: 6%; max-width: 100%;"></span>
            </div>
            <span class="count-badge badge-total">{{ dados_usuario.total }} respostas</span>
            <span class="count-badge badge-acertos">{{ dados_usuario.acertos }} acertos</span>
            <span class="count-badge badge-taxa">{{ dados_usuario.taxa_acerto }}%</span>
        </div>
    </div>
    {% endif %}
</div>

<!-- Cards de A√ß√µes -->
<div class="cards-container">
    <!-- Fazer Quest√µes -->
    <div class="card" style="background: linear-gradient(to top, #00C6FF, #0072FF); color: white;">
        <span class="card-icon">üéØ</span>
        <h3 class="card-title" style="color:#fff;">Fazer Quest√µes</h3>
        <p class="card-description" style="color:#f8f9fa;">Teste seus conhecimentos</p>
        <a href="{% url 'questoes:escolher_assunto' %}" class="btn" style="box-shadow:0 6px 16px rgba(0,114,255,0.35);">Iniciar Quest√µes</a>
    </div>

    <!-- Relatar Problema -->
    <div class="card" style="background: linear-gradient(to top, #FF6B6B, #FF8E53); color: white;">
        <span class="card-icon">üêõ</span>
        <h3 class="card-title" style="color:#fff;">Relatar Problema</h3>
        <p class="card-description" style="color:#f8f9fa;">Reporte bugs e sugest√µes</p>
        <a href="{% url 'questoes:relatar_problema' %}" class="btn" style="box-shadow:0 6px 16px rgba(255,107,107,0.35);">Relatar</a>
    </div>

    {% if user.is_staff %}
    <!-- Gerenciar Quest√µes - Apenas para Admins -->
    <div class="card" style="background: linear-gradient(to top, #00C6FF, #0072FF); color: white;">
        <span class="card-icon">üìã</span>
        <h3 class="card-title" style="color:#fff;">Gerenciar Quest√µes</h3>
        <p class="card-description" style="color:#f8f9fa;">Visualize, edite e organize todas as quest√µes do sistema de forma pr√°tica.</p>
        <a href="{% url 'questoes:gerenciar_questoes' %}" class="btn" style="box-shadow:0 6px 16px rgba(0,114,255,0.35);">Gerenciar</a>
    </div>
    {% endif %}
</div>

{% if user.is_staff %}
<!-- √Årea Administrativa -->
<div class="admin-area">
    <h2>üîß √Årea Administrativa</h2>
    <div class="cards-container">
        <div class="card" style="background: linear-gradient(to top, #00C6FF, #0072FF); color: white;">
            <span class="card-icon">üë®‚Äçüíº</span>
            <h3 class="card-title" style="color:#fff;">Dashboard Admin</h3>
            <p class="card-description" style="color:#f8f9fa;">Acesse o painel administrativo completo do sistema.</p>
            <a href="{% url 'questoes:admin_dashboard' %}" class="btn">Dashboard</a>
        </div>

        {% comment %}
        <div class="card" style="background: linear-gradient(to top, #00C6FF, #0072FF); color: white;">
            <span class="card-icon">üìù</span>
            <h3 class="card-title" style="color:#fff;">Adicionar Conte√∫do</h3>
            <p class="card-description" style="color:#f8f9fa;">Crie novos conte√∫dos para organizar as quest√µes.</p>
            <a href="{% url 'questoes:adicionar_assunto' %}" class="btn">Novo Conte√∫do</a>
        </div>
        {% endcomment %}

        <div class="card" style="background: linear-gradient(to top, #00C6FF, #0072FF); color: white;">
            <span class="card-icon">‚ùì</span>
            <h3 class="card-title" style="color:#fff;">Adicionar Quest√£o</h3>
            <p class="card-description" style="color:#f8f9fa;">Interface administrativa para criar quest√µes completas.</p>
            <a href="{% url 'questoes:adicionar_questao' %}" class="btn">Nova Quest√£o</a>
        </div>

        {% comment %}
        Rota n√£o implementada ainda
        <div class="card" style="background: linear-gradient(to top, #FF6B6B, #FF8E53); color: white;">
            <span class="card-icon">üêõ</span>
            <h3 class="card-title" style="color:#fff;">Gerenciar Relat√≥rios</h3>
            <p class="card-description" style="color:#f8f9fa;">Visualize e responda relat√≥rios de bugs e sugest√µes.</p>
            <a href="{% url 'questoes:gerenciar_relatorios' %}" class="btn">Gerenciar</a>
        </div>
        {% endcomment %}
    </div>
</div>
{% else %}
<!-- √Årea Restrita -->
<div class="restricted-area">
    <h2>üîí √Årea Administrativa</h2>
    <p>√Årea restrita para administradores</p>
    <p>Fa√ßa login como administrador para acessar essas funcionalidades</p>
</div>
{% endif %}

<script>
// Cards clic√°veis
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
        const link = card.querySelector('a.btn');
        if (link) {
            card.style.cursor = 'pointer';
            card.addEventListener('click', () => {
                window.location.href = link.href;
            });
        }
    });
});
</script>

{% endblock %}

